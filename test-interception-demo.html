<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interzept Interception Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        .normal-button {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }
        .normal-button:hover {
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            border-left: 4px solid #00b894;
        }
        .error {
            border-left-color: #e17055;
            background: rgba(225, 112, 85, 0.1);
        }
        .intercepted {
            border-left-color: #fdcb6e;
            background: rgba(253, 203, 110, 0.1);
        }
        h1, h2 {
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .status {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }
        .status.ready {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
        }
        .status.waiting {
            background: rgba(253, 203, 110, 0.2);
            border: 1px solid #fdcb6e;
        }
        .instructions {
            background: rgba(116, 185, 255, 0.1);
            border: 1px solid #74b9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .code {
            background: rgba(0, 0, 0, 0.4);
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Interzept Request Interception Demo</h1>
          <div class="instructions">
            <h3>üìã Setup Instructions:</h3>
            <ol>
                <li><strong>Install Extension:</strong> Load the Interzept extension from the <code class="code">dist/</code> folder</li>
                <li><strong>Grant Permissions:</strong> 
                    <ul>
                        <li>Right-click extension icon ‚Üí Options</li>
                        <li>You'll see an amber "Grant Permissions" button</li>
                        <li>Click it and allow Chrome to grant host permissions</li>
                        <li>Status should turn green ‚úÖ</li>
                    </ul>
                </li>
                <li><strong>Add Override Rule:</strong>
                    <ul>
                        <li><strong>Source:</strong> <code class="code">*/api/intercepted</code></li>
                        <li><strong>Response:</strong> <code class="code">{"intercepted": true, "message": "This was intercepted by Interzept!"}</code></li>
                        <li><strong>Status:</strong> <code class="code">200</code></li>
                    </ul>
                </li>
                <li><strong>Test:</strong> Return to this page and test the buttons below</li>
                <li><strong>Debug:</strong> Open Chrome DevTools ‚Üí Console tab to see Interzept logs</li>
            </ol>

            <div style="background: rgba(253, 203, 110, 0.1); border: 1px solid #fdcb6e; border-radius: 8px; padding: 15px; margin-top: 15px;">
                <h4 style="margin-top: 0; color: #fdcb6e;">üîê About Optional Permissions:</h4>
                <p style="margin-bottom: 0; font-size: 14px;">
                    This extension now uses <strong>optional host permissions</strong> for better security. 
                    You'll need to explicitly grant permission for request interception to work. 
                    This gives you control over when the extension can access websites.
                </p>
            </div>
        </div>

        <div id="status" class="status waiting">
            ‚è≥ Waiting for you to set up the extension...
        </div>

        <div class="section">
            <h2>üî¥ Intercepted Requests</h2>
            <p>These should be caught by Interzept and return mock data:</p>
            
            <button class="test-button" onclick="testInterceptedAPI()">
                Test */api/intercepted
            </button>
            <button class="test-button" onclick="testInterceptedAPI2()">
                Test */api/intercepted/users
            </button>
            
            <div id="intercepted-results"></div>
        </div>

        <div class="section">
            <h2>üîµ Normal Requests</h2>
            <p>These should pass through normally (and likely fail since the endpoints don't exist):</p>
            
            <button class="test-button normal-button" onclick="testNormalAPI()">
                Test */api/normal
            </button>
            <button class="test-button normal-button" onclick="testExternalAPI()">
                Test External API
            </button>
            <button class="test-button normal-button" onclick="loadImage()">
                Load Image (Non-XHR)
            </button>
            
            <div id="normal-results"></div>
        </div>

        <div class="section">
            <h2>üìä Network Tab Observations</h2>
            <div id="network-info" class="result">
                Open Chrome DevTools ‚Üí Network tab and watch what happens:

                üî¥ Intercepted requests:
                - You'll see a request to a data: URL instead of the original URL
                - Status will be 200 with your mock response
                - Original URL request is blocked before it reaches the server

                üîµ Normal requests:
                - You'll see the actual HTTP request being made
                - These will likely fail (404/CORS) since the endpoints don't exist
                - Interzept doesn't touch these at all

                üì± Other requests (images, CSS, etc.):
                - Work completely normally
                - Interzept only affects XMLHttpRequest/fetch calls
            </div>
        </div>
    </div>

    <script>
        // Check if extension is loaded
        setTimeout(() => {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status ready';
            statusEl.innerHTML = '‚úÖ Ready to test! Check Chrome DevTools Console for Interzept logs.';
        }, 2000);

        function addResult(containerId, title, data, isError = false, isIntercepted = false) {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `result ${isError ? 'error' : ''} ${isIntercepted ? 'intercepted' : ''}`;
            
            const timestamp = new Date().toLocaleTimeString();
            result.innerHTML = `[${timestamp}] ${title}\n${JSON.stringify(data, null, 2)}`;
            
            container.appendChild(result);
            container.scrollTop = container.scrollHeight;
        }

        // Intercepted API calls
        async function testInterceptedAPI() {
            console.log('üî¥ Testing intercepted API call...');
            try {
                const response = await fetch('/api/intercepted');
                const data = await response.json();
                addResult('intercepted-results', '‚úÖ INTERCEPTED: /api/intercepted', {
                    status: response.status,
                    data: data,
                    url: response.url
                }, false, true);
            } catch (error) {
                addResult('intercepted-results', '‚ùå ERROR: /api/intercepted', {
                    error: error.message
                }, true);
            }
        }

        async function testInterceptedAPI2() {
            console.log('üî¥ Testing intercepted API call #2...');
            try {
                const response = await fetch('/api/intercepted/users');
                const data = await response.json();
                addResult('intercepted-results', '‚úÖ INTERCEPTED: /api/intercepted/users', {
                    status: response.status,
                    data: data,
                    url: response.url
                }, false, true);
            } catch (error) {
                addResult('intercepted-results', '‚ùå ERROR: /api/intercepted/users', {
                    error: error.message
                }, true);
            }
        }

        // Normal API calls
        async function testNormalAPI() {
            console.log('üîµ Testing normal API call...');
            try {
                const response = await fetch('/api/normal');
                const data = await response.json();
                addResult('normal-results', 'üîµ NORMAL: /api/normal', {
                    status: response.status,
                    data: data
                });
            } catch (error) {
                addResult('normal-results', '‚ùå NORMAL (Expected): /api/normal', {
                    error: error.message,
                    note: 'This should fail - endpoint doesn\'t exist'
                }, true);
            }
        }

        async function testExternalAPI() {
            console.log('üîµ Testing external API call...');
            try {
                const response = await fetch('https://httpbin.org/json');
                const data = await response.json();
                addResult('normal-results', 'üîµ EXTERNAL: httpbin.org', {
                    status: response.status,
                    data: data
                });
            } catch (error) {
                addResult('normal-results', '‚ùå EXTERNAL: httpbin.org', {
                    error: error.message,
                    note: 'CORS or network error - this is normal'
                }, true);
            }
        }

        function loadImage() {
            console.log('üîµ Testing non-XHR request (image)...');
            const img = new Image();
            img.onload = () => {
                addResult('normal-results', 'üîµ IMAGE: Loaded successfully', {
                    src: img.src,
                    width: img.width,
                    height: img.height,
                    note: 'Images are not intercepted by Interzept'
                });
            };
            img.onerror = () => {
                addResult('normal-results', '‚ùå IMAGE: Failed to load', {
                    src: img.src,
                    note: 'Image failed but this is still not intercepted by Interzept'
                }, true);
            };
            img.src = 'https://httpbin.org/image/png';
        }
    </script>
</body>
</html>
