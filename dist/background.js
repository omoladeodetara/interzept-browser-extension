/*! For license information please see background.js.LICENSE.txt */
(()=>{var e;function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,u=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw u}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",u=r.toStringTag||"@@toStringTag";function a(r,n,i,u){var a=n&&n.prototype instanceof l?n:l,f=Object.create(a.prototype);return o(f,"_invoke",function(r,n,o){var i,u,a,l=0,f=o||[],s=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,u=0,a=e,d.n=r,c}};function p(r,n){for(u=r,a=n,t=0;!s&&l&&!o&&t<f.length;t++){var o,i=f[t],p=d.p,v=i[2];r>3?(o=v===n)&&(u=i[4]||3,a=i[5]===e?i[3]:i[5],i[4]=3,i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(u=0,d.v=n,d.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,d.n=v,u=0))}if(o||r>1)return c;throw s=!0,n}return function(o,f,v){if(l>1)throw TypeError("Generator is already running");for(s&&1===f&&p(f,v),u=f,a=v;(t=u<2?e:a)||!s;){i||(u?u<3?(u>1&&(d.n=-1),p(u,a)):d.n=a:d.v=a);try{if(l=2,i){if(u||(o="next"),t=i[o]){if(!(t=t.call(i,a)))throw TypeError("iterator result is not an object");if(!t.done)return t;a=t.value,u<2&&(u=0)}else 1===u&&(t=i.return)&&t.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((t=(s=d.n<0)?a:r.call(n,d))!==c)break}catch(t){i=e,u=1,a=t}finally{l=1}}return{value:t,done:s}}}(r,i,u),!0),f}var c={};function l(){}function f(){}function s(){}t=Object.getPrototypeOf;var d=[][i]?t(t([][i]())):(o(t={},i,(function(){return this})),t),p=s.prototype=l.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,o(e,u,"GeneratorFunction")),e.prototype=Object.create(p),e}return f.prototype=s,o(p,"constructor",s),o(s,"constructor",f),f.displayName="GeneratorFunction",o(s,u,"GeneratorFunction"),o(p),o(p,u,"Generator"),o(p,i,(function(){return this})),o(p,"toString",(function(){return"[object Generator]"})),(n=function(){return{w:a,m:v}})()}function o(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}o=function(e,t,r,n){if(t)i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var u=function(t,r){o(e,t,(function(e){return this._invoke(t,r,e)}))};u("next",0),u("throw",1),u("return",2)}},o(e,t,r,n)}function i(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var u=e.apply(t,r);function a(e){i(u,n,o,a,c,"next",e)}function c(e){i(u,n,o,a,c,"throw",e)}a(void 0)}))}}function a(){return c.apply(this,arguments)}function c(){return(c=u(n().m((function e(){var r,o,i,u,a,c,l,f,s,d,p,v,y;return n().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,chrome.storage.local.get(["overrideRules"]);case 1:if(r=e.v,0!==(o=r.overrideRules||[]).length){e.n=2;break}return e.a(2);case 2:return e.n=3,chrome.declarativeNetRequest.getSessionRules();case 3:i=e.v,u=i.map((function(e){return e.id})),a=[],c=1e3,l=t(o);try{for(l.s();!(f=l.n()).done;){if(s=f.value,!(d=s.id)||d<1e3||d>=1e4||u.includes(d)){for(;u.includes(c)||a.some((function(e){return e.id===c}));)++c>=1e4&&(c=1e3);d=c++}a.push({id:d,priority:1,condition:{urlFilter:s.urlPattern,resourceTypes:["xmlhttprequest","main_frame","sub_frame"]},action:{type:"redirect",redirect:{url:"data:".concat(s.responseType,",").concat(encodeURIComponent(s.responseBody))}}})}}catch(e){l.e(e)}finally{l.f()}return e.n=4,chrome.declarativeNetRequest.getDynamicRules();case 4:return p=e.v,v=p.map((function(e){return e.id})),e.n=5,chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:v,addRules:a});case 5:console.log("Restored ".concat(a.length," override rules")),e.n=7;break;case 6:e.p=6,y=e.v,console.error("Error restoring rules:",y);case 7:return e.a(2)}}),e,null,[[0,6]])})))).apply(this,arguments)}chrome.runtime.onStartup.addListener(u(n().m((function e(){return n().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,a();case 1:return e.a(2)}}),e)})))),chrome.runtime.onInstalled.addListener(u(n().m((function e(){return n().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,a();case 1:return e.a(2)}}),e)})))),chrome.runtime.onMessage.addListener((function(e,t,r){if("getRuleCount"===e.action)return chrome.declarativeNetRequest.getDynamicRules().then((function(e){r({count:e.length})})),!0})),null===(e=chrome.declarativeNetRequest.onRuleMatchedDebug)||void 0===e||e.addListener((function(e){console.log("Rule matched:",e)}))})();